<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGMC Smart Ticketing System</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>NGMC Smart Ticketing</h1>
            <p>Streamlined IT support for seamless operations</p>
        </header>

        <div class="ticket-dashboard">
            <div class="dashboard-card floating">
                <i class="fas fa-ticket-alt" style="font-size: 2rem; color: var(--info); margin-bottom: 1rem;"></i>
                <span id="totalCount">{{ total }}</span>
                <div class="stat-label">Total Tickets</div>
            </div>
            
            <div class="dashboard-card floating" style="animation-delay: 0.1s;">
                <i class="fas fa-clock" style="font-size: 2rem; color: var(--warning); margin-bottom: 1rem;"></i>
                <span id="processCount">{{ in_process }}</span>
                <div class="stat-label">In Progress</div>
            </div>
            
            <div class="dashboard-card floating" style="animation-delay: 0.2s;">
                <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 1rem;"></i>
                <span id="solvedCount">{{ solved }}</span>
                <div class="stat-label">Resolved</div>
            </div>
        </div>

        <div class="ticket-form">
            <h2 class="form-title">Create New Ticket</h2>
            
            <form action="{{ url_for('create_ticket') }}" method="post" enctype="multipart/form-data" id="ticketForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="department">
                            <i class="fas fa-building"></i> Department
                        </label>
                        <div class="input-wrapper">
                            <select id="department" name="department" required>
                                <option value="" disabled selected>Select Department</option>
                                {% for dept in departments %}
                                    <option value="{{ dept }}">{{ dept }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="system">
                            <i class="fas fa-desktop"></i> System/Equipment
                        </label>
                        <div class="input-wrapper">
                            <input type="text" id="system" name="system" placeholder="e.g., Projector Room 101, Computer Lab 3" required>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="problem">
                            <i class="fas fa-exclamation-triangle"></i> Problem Description
                        </label>
                        <div class="input-wrapper">
                            <textarea id="problem" name="problem" placeholder="Describe the issue you're experiencing in detail..." required></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i> Your Email
                        </label>
                        <div class="input-wrapper">
                            <input type="email" id="email" name="email" placeholder="your.email@ngmc.edu" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="severity">
                            <i class="fas fa-exclamation"></i> Priority Level
                        </label>
                        <div class="input-wrapper">
                            <select id="severity" name="severity" required>
                                <option value="Low">ðŸŸ¢ Low - Can wait</option>
                                <option value="Medium" selected>ðŸŸ¡ Medium - Normal</option>
                                <option value="High">ðŸŸ  High - Urgent</option>
                                <option value="Critical">ðŸ”´ Critical - Emergency</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="image">
                            <i class="fas fa-camera"></i> Attach Image (Optional)
                        </label>
                        <div class="file-input-wrapper">
                            <input type="file" id="image" name="image" accept="image/*" capture="environment">
                            <div class="file-input-content">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem; display: block;"></i>
                                <div>Click to upload or drag & drop</div>
                                <small>PNG, JPG up to 10MB</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-paper-plane"></i> Submit Ticket
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <a href="{{ url_for('admin_login') }}" class="admin-link" title="Admin Panel">
        <i class="fas fa-user-shield"></i>
    </a>

    <div class="flash-messages" id="flashMessages">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="flash-message">
                        <i class="fas fa-check-circle"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <script>
        // Animate numbers on page load
        function animateCounter(element, target, duration = 2000) {
            const startValue = parseInt(element.textContent) || 0;
            if (startValue === target) return;
            
            let start = startValue;
            const increment = (target - startValue) / (duration / 16);
            const timer = setInterval(() => {
                start += increment;
                if ((increment > 0 && start >= target) || (increment < 0 && start <= target)) {
                    start = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(start);
            }, 16);
        }

        // Initialize counters with smooth animation
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const totalElement = document.getElementById('totalCount');
                const processElement = document.getElementById('processCount');
                const solvedElement = document.getElementById('solvedCount');
                
                animateCounter(totalElement, parseInt(totalElement.textContent));
                animateCounter(processElement, parseInt(processElement.textContent));
                animateCounter(solvedElement, parseInt(solvedElement.textContent));
            }, 500);
        });

        // Enhanced form handling
        document.getElementById('ticketForm').addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            
            // Add loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            // Add visual feedback
            submitBtn.style.background = 'linear-gradient(135deg, #666 0%, #888 100%)';
            
            // Create particle effect
            createParticles();
        });

        // File input enhancement with preview
        const fileInput = document.getElementById('image');
        const fileInputWrapper = fileInput.closest('.file-input-wrapper');
        const fileContent = fileInputWrapper.querySelector('.file-input-content');

        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const fileName = file.name;
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                fileContent.innerHTML = `
                    <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 0.5rem; display: block;"></i>
                    <div><strong>${fileName}</strong></div>
                    <small>${fileSize} MB â€¢ Click to change file</small>
                `;
                fileInputWrapper.style.borderColor = 'var(--success)';
                fileInputWrapper.style.background = 'rgba(16, 185, 129, 0.05)';
            }
        });

        // Enhanced drag and drop functionality
        fileInputWrapper.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = 'var(--primary)';
            this.style.background = 'rgba(102, 126, 234, 0.1)';
            this.style.transform = 'scale(1.02)';
        });

        fileInputWrapper.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            this.style.background = 'rgba(255, 255, 255, 0.02)';
            this.style.transform = 'scale(1)';
        });

        fileInputWrapper.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileInput.dispatchEvent(new Event('change'));
            }
            this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            this.style.background = 'rgba(255, 255, 255, 0.02)';
            this.style.transform = 'scale(1)';
        });

        // Add particle effect function
        function createParticles() {
            const container = document.querySelector('.ticket-form');
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 6px;
                    height: 6px;
                    background: var(--primary);
                    border-radius: 50%;
                    pointer-events: none;
                    opacity: 0;
                    animation: particle 2s ease-out forwards;
                    animation-delay: ${i * 0.1}s;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    z-index: 1000;
                `;
                container.appendChild(particle);
                
                setTimeout(() => particle.remove(), 2000);
            }
        }

        // Add particle animation CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes particle {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Auto-dismiss flash messages
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(message => {
                setTimeout(() => {
                    message.style.animation = 'slideInRight 0.5s ease-out reverse';
                    setTimeout(() => message.remove(), 500);
                }, 5000);
            });
        });

        // Form validation enhancements
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.checkValidity()) {
                    this.style.borderColor = 'var(--success)';
                } else {
                    this.style.borderColor = 'var(--error)';
                }
            });

            input.addEventListener('input', function() {
                if (this.style.borderColor === 'var(--error)' || this.style.borderColor === 'var(--success)') {
                    this.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                }
            });
        });
    </script>